



<!DOCTYPE html>
<html lang="en">
  
  <head>
    
      <meta charset="utf-8">
      <title>Bokeh Plot</title>
      
<style>
    .acoeffs {
        background-color: #EFF7FE;
        padding: 5px;
        width: inherit;
    }
    .bcoeffs {
        background-color: #E8FFF3;
        padding: 5px;
        width: inherit;
    }
    .tqcoeffs {
        background-color: #EDE1EA;
        padding: 5px;
        width: inherit;
    }
</style>


<script type="text/javascript">
    function linspace(a,b,n) {
        if(typeof n === "undefined") n = Math.max(Math.round(b-a)+1,1);
        if(n<2) { return n===1?[a]:[]; }
        var i,ret = Array(n);
        n--;
        for(i=n;i>=0;i--) { ret[i] = (i*b+(n-i)*a)/n; }
        return ret;
    }

    function polyeval3(coeffs) {
        return function(x){
            return coeffs[2]*x*x + coeffs[1]*x + coeffs[0];
        }
    }

    function polyeval4(coeffs) {
        return function(x){
            return coeffs[3]*x*x*x + coeffs[2]*x*x + coeffs[1]*x + coeffs[0];
        }
    }

    window.normalizeAndCenter=function(ay) {
        let maxval = Math.max(...ay)
        return ay.map(x => x / maxval - 0.5)
    }

    window.splineWave=function(coeffs, time) {
        const wave = time.map(polyeval4(coeffs));
        return wave;
    }
    
    window.counts=function(ay, N) {
        let dx = Math.max(...ay) / N
        ay = ay.map(el => Math.floor(el / dx))
        let counts = new Array(N).fill(0);
        for (var i = 0; i < ay.length; i++) {
            counts[ay[i]] += 1;
        }
        if (counts.length != N) {
            counts.pop();
        }
        return counts;
    }
    
    window.reciprocal=function(ay) {
        return ay.map(x => 1/x);
    }
    
    window.quadWave=function(coeffs, time) {
        const wave = time.map(polyeval3(coeffs));
        return wave;
    }
    window.setSpanPosition=function(span, pos) {
        span.location = pos;
    }
    
    window.integrate=function(time, amp) {
        let moment = [0];
        for (i=0; i < (time.length -1); i++) {
            let dt = time[i+1] - time[i];
            let meanamp = (amp[i+1] - amp[i]) / 2 + amp[i];
            moment.push(dt*meanamp + moment[i]);
        }
        return moment;
    }
</script>

      
        
          
        
        
          
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-1.4.0.min.js"></script>
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.4.0.min.js"></script>
        <script type="text/javascript">
            Bokeh.set_log_level("info");
        </script>
        
      
      
    
  </head>
  
  
  <body>
    
      
        
          
          
            
              <div class="bk-root" id="8e86d058-1fd1-454a-9878-5c76496d9c77" data-root-id="1288"></div>
            
          
        
      
      
        <script type="application/json" id="1742">
          {"6eab4db8-bbf8-40ec-a253-1c21c0a72515":{"roots":{"references":[{"attributes":{},"id":"1145","type":"BasicTicker"},{"attributes":{"dimension":1,"ticker":{"id":"1145","type":"BasicTicker"}},"id":"1148","type":"Grid"},{"attributes":{"dimension":"height","level":"underlay","line_color":{"value":"chocolate"},"line_dash":[6],"line_width":{"value":2},"location":-1,"name":"echoM"},"id":"1164","type":"Span"},{"attributes":{"dimension":"height","level":"underlay","line_color":{"value":"#6B8E23"},"line_dash":[6],"line_width":{"value":2},"location":-1,"name":"mid"},"id":"1163","type":"Span"},{"attributes":{"dimension":"height","level":"underlay","line_color":{"value":"#6B8E23"},"line_dash":[6],"line_width":{"value":2},"location":-1,"name":"midM"},"id":"1165","type":"Span"},{"attributes":{},"id":"1149","type":"PanTool"},{"attributes":{},"id":"1150","type":"WheelZoomTool"},{"attributes":{"overlay":{"id":"1249","type":"BoxAnnotation"}},"id":"1151","type":"BoxZoomTool"},{"attributes":{},"id":"1084","type":"WheelZoomTool"},{"attributes":{},"id":"1152","type":"SaveTool"},{"attributes":{},"id":"1153","type":"ResetTool"},{"attributes":{},"id":"1154","type":"HelpTool"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1149","type":"PanTool"},{"id":"1150","type":"WheelZoomTool"},{"id":"1151","type":"BoxZoomTool"},{"id":"1152","type":"SaveTool"},{"id":"1153","type":"ResetTool"},{"id":"1154","type":"HelpTool"}]},"id":"1155","type":"Toolbar"},{"attributes":{"dimension":"height","level":"underlay","line_color":{"value":"chocolate"},"line_dash":[6],"line_width":{"value":2},"location":-1,"name":"echoQ"},"id":"1166","type":"Span"},{"attributes":{"dimension":"height","level":"underlay","line_color":{"value":"#6B8E23"},"line_dash":[6],"line_width":{"value":2},"location":-1,"name":"midQ"},"id":"1167","type":"Span"},{"attributes":{"css_classes":["acoeffs"]},"id":"1168","type":"Div"},{"attributes":{"css_classes":["bcoeffs"]},"id":"1169","type":"Div"},{"attributes":{"css_classes":["tqcoeffs"]},"id":"1170","type":"Div"},{"attributes":{"source":{"id":"1176","type":"ColumnDataSource"}},"id":"1242","type":"CDSView"},{"attributes":{"css_classes":["summary"]},"id":"1171","type":"Div"},{"attributes":{"callback":null,"data":{"amp":[0,0],"time":[0,1]},"selected":{"id":"1315","type":"Selection"},"selection_policy":{"id":"1316","type":"UnionRenderers"}},"id":"1172","type":"ColumnDataSource"},{"attributes":{"callback":null,"data":{"amp":[0,0],"time":[0,1]},"selected":{"id":"1318","type":"Selection"},"selection_policy":{"id":"1319","type":"UnionRenderers"}},"id":"1173","type":"ColumnDataSource"},{"attributes":{"callback":null,"data":{"amp":[0,0],"time":[0,1]},"selected":{"id":"1320","type":"Selection"},"selection_policy":{"id":"1321","type":"UnionRenderers"}},"id":"1174","type":"ColumnDataSource"},{"attributes":{"callback":null,"data":{"quad":[0,1],"spline":[0,1],"time":[0,1]},"selected":{"id":"1323","type":"Selection"},"selection_policy":{"id":"1324","type":"UnionRenderers"}},"id":"1175","type":"ColumnDataSource"},{"attributes":{"callback":null,"data":{"quad":[1,3],"samples":[0,1],"spline":[1,2],"trap":[1,1]},"selected":{"id":"1230","type":"Selection"},"selection_policy":{"id":"1231","type":"UnionRenderers"}},"id":"1176","type":"ColumnDataSource"},{"attributes":{"callback":null,"end":100},"id":"1177","type":"Range1d"},{"attributes":{"data_source":{"id":"1172","type":"ColumnDataSource"},"glyph":{"id":"1179","type":"Line"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1180","type":"Line"},"selection_glyph":null,"view":{"id":"1182","type":"CDSView"}},"id":"1181","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1172","type":"ColumnDataSource"}},"id":"1182","type":"CDSView"},{"attributes":{"overlay":{"id":"1322","type":"BoxAnnotation"}},"id":"1085","type":"BoxZoomTool"},{"attributes":{"format":"0.0"},"id":"1267","type":"NumeralTickFormatter"},{"attributes":{"fields":[]},"id":"1234","type":"Stack"},{"attributes":{"line_color":"orchid","line_width":2,"x":{"field":"time"},"y":{"field":"spline"}},"id":"1184","type":"Line"},{"attributes":{"below":[{"id":"1010","type":"LinearAxis"}],"center":[{"id":"1014","type":"Grid"},{"id":"1019","type":"Grid"},{"id":"1162","type":"Span"},{"id":"1163","type":"Span"}],"left":[{"id":"1015","type":"LinearAxis"}],"plot_height":400,"renderers":[{"id":"1181","type":"GlyphRenderer"}],"title":{"id":"1290","type":"Title"},"toolbar":{"id":"1026","type":"Toolbar"},"toolbar_location":null,"x_range":{"id":"1002","type":"DataRange1d"},"x_scale":{"id":"1006","type":"LinearScale"},"y_range":{"id":"1004","type":"DataRange1d"},"y_scale":{"id":"1008","type":"LinearScale"}},"id":"1001","subtype":"Figure","type":"Plot"},{"attributes":{"line_alpha":0.1,"line_color":"#1f77b4","line_width":2,"x":{"field":"time"},"y":{"field":"spline"}},"id":"1185","type":"Line"},{"attributes":{"below":[{"id":"1042","type":"LinearAxis"}],"center":[{"id":"1046","type":"Grid"},{"id":"1051","type":"Grid"},{"id":"1164","type":"Span"},{"id":"1165","type":"Span"}],"left":[{"id":"1047","type":"LinearAxis"}],"plot_height":200,"renderers":[{"id":"1186","type":"GlyphRenderer"},{"id":"1191","type":"GlyphRenderer"}],"title":{"id":"1294","type":"Title"},"toolbar":{"id":"1058","type":"Toolbar"},"toolbar_location":null,"x_range":{"id":"1034","type":"DataRange1d"},"x_scale":{"id":"1038","type":"LinearScale"},"y_range":{"id":"1036","type":"DataRange1d"},"y_scale":{"id":"1040","type":"LinearScale"}},"id":"1033","subtype":"Figure","type":"Plot"},{"attributes":{"data_source":{"id":"1175","type":"ColumnDataSource"},"glyph":{"id":"1184","type":"Line"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1185","type":"Line"},"selection_glyph":null,"view":{"id":"1187","type":"CDSView"}},"id":"1186","type":"GlyphRenderer"},{"attributes":{"callback":null},"id":"1002","type":"DataRange1d"},{"attributes":{"source":{"id":"1175","type":"ColumnDataSource"}},"id":"1187","type":"CDSView"},{"attributes":{"callback":null},"id":"1004","type":"DataRange1d"},{"attributes":{"label":{"value":"Spline"},"renderers":[{"id":"1223","type":"GlyphRenderer"}]},"id":"1233","type":"LegendItem"},{"attributes":{},"id":"1006","type":"LinearScale"},{"attributes":{"line_color":"olive","line_width":2,"x":{"field":"time"},"y":{"field":"quad"}},"id":"1189","type":"Line"},{"attributes":{},"id":"1008","type":"LinearScale"},{"attributes":{"line_alpha":0.1,"line_color":"#1f77b4","line_width":2,"x":{"field":"time"},"y":{"field":"quad"}},"id":"1190","type":"Line"},{"attributes":{"axis_label":"Time [ms]","formatter":{"id":"1300","type":"BasicTickFormatter"},"ticker":{"id":"1011","type":"BasicTicker"}},"id":"1010","type":"LinearAxis"},{"attributes":{"data_source":{"id":"1175","type":"ColumnDataSource"},"glyph":{"id":"1189","type":"Line"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1190","type":"Line"},"selection_glyph":null,"view":{"id":"1192","type":"CDSView"}},"id":"1191","type":"GlyphRenderer"},{"attributes":{},"id":"1011","type":"BasicTicker"},{"attributes":{"text":""},"id":"1294","type":"Title"},{"attributes":{"source":{"id":"1175","type":"ColumnDataSource"}},"id":"1192","type":"CDSView"},{"attributes":{"ticker":{"id":"1011","type":"BasicTicker"}},"id":"1014","type":"Grid"},{"attributes":{"axis_label":"Amplitude [G/cm]","formatter":{"id":"1271","type":"NumeralTickFormatter"},"ticker":{"id":"1079","type":"BasicTicker"}},"id":"1078","type":"LinearAxis"},{"attributes":{"text":""},"id":"1244","type":"Title"},{"attributes":{"children":[{"id":"1283","type":"Column"},{"id":"1285","type":"Column"},{"id":"1286","type":"Column"}]},"id":"1287","type":"Row"},{"attributes":{},"id":"1300","type":"BasicTickFormatter"},{"attributes":{"axis_label":"Amplitude [G/cm]","formatter":{"id":"1267","type":"NumeralTickFormatter"},"ticker":{"id":"1016","type":"BasicTicker"}},"id":"1015","type":"LinearAxis"},{"attributes":{},"id":"1079","type":"BasicTicker"},{"attributes":{"fill_color":"lightsalmon","x":{"field":"samples"},"y1":{"expr":{"id":"1234","type":"Stack"}},"y2":{"expr":{"id":"1235","type":"Stack"}}},"id":"1239","type":"VArea"},{"attributes":{"line_alpha":0.5,"line_color":"salmon","line_width":2,"x":{"field":"time"},"y":{"field":"amp"}},"id":"1194","type":"Line"},{"attributes":{},"id":"1303","type":"BasicTickFormatter"},{"attributes":{},"id":"1246","type":"BasicTickFormatter"},{"attributes":{"dimension":1,"ticker":{"id":"1079","type":"BasicTicker"}},"id":"1082","type":"Grid"},{"attributes":{},"id":"1016","type":"BasicTicker"},{"attributes":{},"id":"1248","type":"BasicTickFormatter"},{"attributes":{"line_alpha":0.1,"line_color":"#1f77b4","line_width":2,"x":{"field":"time"},"y":{"field":"amp"}},"id":"1195","type":"Line"},{"attributes":{},"id":"1306","type":"BasicTickFormatter"},{"attributes":{"dimension":1,"ticker":{"id":"1016","type":"BasicTicker"}},"id":"1019","type":"Grid"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1249","type":"BoxAnnotation"},{"attributes":{"data_source":{"id":"1173","type":"ColumnDataSource"},"glyph":{"id":"1194","type":"Line"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1195","type":"Line"},"selection_glyph":null,"view":{"id":"1197","type":"CDSView"}},"id":"1196","type":"GlyphRenderer"},{"attributes":{"text":"Sampling density (eff. dwell time across k-space)"},"id":"1097","type":"Title"},{"attributes":{"items":[{"id":"1251","type":"LegendItem"},{"id":"1266","type":"LegendItem"}],"location":"top_center","orientation":"horizontal"},"id":"1250","type":"Legend"},{"attributes":{},"id":"1316","type":"UnionRenderers"},{"attributes":{"callback":null},"id":"1034","type":"DataRange1d"},{"attributes":{"source":{"id":"1173","type":"ColumnDataSource"}},"id":"1197","type":"CDSView"},{"attributes":{"label":{"value":"Trap"},"renderers":[{"id":"1241","type":"GlyphRenderer"}]},"id":"1251","type":"LegendItem"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1317","type":"BoxAnnotation"},{"attributes":{},"id":"1083","type":"PanTool"},{"attributes":{"children":[{"id":"1287","type":"Row"}]},"id":"1288","type":"Column"},{"attributes":{},"id":"1318","type":"Selection"},{"attributes":{"children":[{"id":"1281","type":"Column"},{"id":"1284","type":"Row"},{"id":"1282","type":"Row"},{"id":"1171","type":"Div"}]},"id":"1285","type":"Column"},{"attributes":{},"id":"1020","type":"PanTool"},{"attributes":{"line_color":"olive","line_width":2,"x":{"field":"time"},"y":{"field":"amp"}},"id":"1199","type":"Line"},{"attributes":{},"id":"1086","type":"SaveTool"},{"attributes":{"fill_color":"thistle","x":{"field":"samples"},"y1":{"expr":{"id":"1236","type":"Stack"}},"y2":{"expr":{"id":"1237","type":"Stack"}}},"id":"1253","type":"VArea"},{"attributes":{},"id":"1319","type":"UnionRenderers"},{"attributes":{},"id":"1021","type":"WheelZoomTool"},{"attributes":{"line_alpha":0.1,"line_color":"#1f77b4","line_width":2,"x":{"field":"time"},"y":{"field":"amp"}},"id":"1200","type":"Line"},{"attributes":{},"id":"1087","type":"ResetTool"},{"attributes":{"fill_alpha":0.1,"fill_color":"#1f77b4","x":{"field":"samples"},"y1":{"expr":{"id":"1236","type":"Stack"}},"y2":{"expr":{"id":"1237","type":"Stack"}}},"id":"1254","type":"VArea"},{"attributes":{"axis_label":"Time per sample [us]","formatter":{"id":"1246","type":"BasicTickFormatter"},"ticker":{"id":"1145","type":"BasicTicker"}},"id":"1144","type":"LinearAxis"},{"attributes":{},"id":"1320","type":"Selection"},{"attributes":{"data_source":{"id":"1174","type":"ColumnDataSource"},"glyph":{"id":"1199","type":"Line"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1200","type":"Line"},"selection_glyph":null,"view":{"id":"1202","type":"CDSView"}},"id":"1201","type":"GlyphRenderer"},{"attributes":{"overlay":{"id":"1317","type":"BoxAnnotation"}},"id":"1022","type":"BoxZoomTool"},{"attributes":{},"id":"1088","type":"HelpTool"},{"attributes":{"data_source":{"id":"1176","type":"ColumnDataSource"},"glyph":{"id":"1253","type":"VArea"},"hover_glyph":null,"muted_glyph":null,"name":"spline","nonselection_glyph":{"id":"1254","type":"VArea"},"selection_glyph":null,"view":{"id":"1256","type":"CDSView"}},"id":"1255","type":"GlyphRenderer"},{"attributes":{},"id":"1321","type":"UnionRenderers"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1083","type":"PanTool"},{"id":"1084","type":"WheelZoomTool"},{"id":"1085","type":"BoxZoomTool"},{"id":"1086","type":"SaveTool"},{"id":"1087","type":"ResetTool"},{"id":"1088","type":"HelpTool"}]},"id":"1089","type":"Toolbar"},{"attributes":{},"id":"1023","type":"SaveTool"},{"attributes":{"source":{"id":"1174","type":"ColumnDataSource"}},"id":"1202","type":"CDSView"},{"attributes":{"callback":null},"id":"1099","type":"DataRange1d"},{"attributes":{"source":{"id":"1176","type":"ColumnDataSource"}},"id":"1256","type":"CDSView"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1322","type":"BoxAnnotation"},{"attributes":{},"id":"1024","type":"ResetTool"},{"attributes":{"line_color":"orchid","line_width":2,"x":{"field":"time"},"y":{"field":"amp"}},"id":"1179","type":"Line"},{"attributes":{"label":{"value":"Spline"},"renderers":[{"id":"1255","type":"GlyphRenderer"}]},"id":"1266","type":"LegendItem"},{"attributes":{},"id":"1323","type":"Selection"},{"attributes":{},"id":"1025","type":"HelpTool"},{"attributes":{"fields":[]},"id":"1203","type":"Stack"},{"attributes":{},"id":"1103","type":"LinearScale"},{"attributes":{},"id":"1324","type":"UnionRenderers"},{"attributes":{"fields":["quad"]},"id":"1204","type":"Stack"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1020","type":"PanTool"},{"id":"1021","type":"WheelZoomTool"},{"id":"1022","type":"BoxZoomTool"},{"id":"1023","type":"SaveTool"},{"id":"1024","type":"ResetTool"},{"id":"1025","type":"HelpTool"}]},"id":"1026","type":"Toolbar"},{"attributes":{"format":"0.0"},"id":"1269","type":"NumeralTickFormatter"},{"attributes":{"callback":null},"id":"1036","type":"DataRange1d"},{"attributes":{},"id":"1105","type":"LinearScale"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1325","type":"BoxAnnotation"},{"attributes":{"format":"0.0"},"id":"1271","type":"NumeralTickFormatter"},{"attributes":{"fields":["quad"]},"id":"1205","type":"Stack"},{"attributes":{"formatter":{"id":"1216","type":"BasicTickFormatter"},"ticker":{"id":"1108","type":"BasicTicker"}},"id":"1107","type":"LinearAxis"},{"attributes":{"fields":["quad","spline"]},"id":"1206","type":"Stack"},{"attributes":{},"id":"1038","type":"LinearScale"},{"attributes":{"active":[0],"callback":null,"labels":["Mirror positive shifts"]},"id":"1273","type":"CheckboxGroup"},{"attributes":{},"id":"1040","type":"LinearScale"},{"attributes":{},"id":"1108","type":"BasicTicker"},{"attributes":{},"id":"1315","type":"Selection"},{"attributes":{"callback":null,"end":1,"js_property_callbacks":{"change:value":[{"id":"1280","type":"CustomJS"}]},"name":"tas","start":0,"step":0.05,"title":"Acquisition start (tas) [ms]","value":0.6},"id":"1274","type":"Slider"},{"attributes":{"fields":["trap","spline"]},"id":"1237","type":"Stack"},{"attributes":{"ticker":{"id":"1108","type":"BasicTicker"}},"id":"1111","type":"Grid"},{"attributes":{"formatter":{"id":"1306","type":"BasicTickFormatter"},"ticker":{"id":"1043","type":"BasicTicker"}},"id":"1042","type":"LinearAxis"},{"attributes":{"fill_color":"olive","x":{"field":"samples"},"y1":{"expr":{"id":"1203","type":"Stack"}},"y2":{"expr":{"id":"1204","type":"Stack"}}},"id":"1208","type":"VArea"},{"attributes":{"callback":null,"end":2,"js_property_callbacks":{"change:value":[{"id":"1280","type":"CustomJS"}]},"name":"shift","start":-2,"step":0.1,"title":"CSE shift [ms]","value":0},"id":"1275","type":"Slider"},{"attributes":{"axis_label":"Time per sample [us]","formatter":{"id":"1214","type":"BasicTickFormatter"},"ticker":{"id":"1113","type":"BasicTicker"}},"id":"1112","type":"LinearAxis"},{"attributes":{},"id":"1043","type":"BasicTicker"},{"attributes":{"fill_alpha":0.1,"fill_color":"#1f77b4","x":{"field":"samples"},"y1":{"expr":{"id":"1203","type":"Stack"}},"y2":{"expr":{"id":"1204","type":"Stack"}}},"id":"1209","type":"VArea"},{"attributes":{"callback":null,"end":10,"js_property_callbacks":{"change:value":[{"id":"1280","type":"CustomJS"}]},"name":"tacq","start":0,"title":"Acquisition time [ms]","value":5},"id":"1276","type":"Slider"},{"attributes":{"ticker":{"id":"1043","type":"BasicTicker"}},"id":"1046","type":"Grid"},{"attributes":{"data_source":{"id":"1176","type":"ColumnDataSource"},"glyph":{"id":"1208","type":"VArea"},"hover_glyph":null,"muted_glyph":null,"name":"quad","nonselection_glyph":{"id":"1209","type":"VArea"},"selection_glyph":null,"view":{"id":"1211","type":"CDSView"}},"id":"1210","type":"GlyphRenderer"},{"attributes":{},"id":"1113","type":"BasicTicker"},{"attributes":{"callback":null,"end":0.15,"js_property_callbacks":{"change:value":[{"id":"1280","type":"CustomJS"}]},"name":"Mp","start":0,"step":0.01,"title":"Padding area (Mp) [G/cm * ms]","value":0.1},"id":"1277","type":"Slider"},{"attributes":{"axis_label":"k-Space coordinate","formatter":{"id":"1269","type":"NumeralTickFormatter"},"ticker":{"id":"1048","type":"BasicTicker"}},"id":"1047","type":"LinearAxis"},{"attributes":{"dimension":1,"ticker":{"id":"1113","type":"BasicTicker"}},"id":"1116","type":"Grid"},{"attributes":{"source":{"id":"1176","type":"ColumnDataSource"}},"id":"1211","type":"CDSView"},{"attributes":{"callback":null,"end":5,"js_property_callbacks":{"change:value":[{"id":"1280","type":"CustomJS"}]},"name":"M","start":0.55,"step":0.25,"title":"Sampling area (M), [G/cm * ms]","value":3.3},"id":"1278","type":"Slider"},{"attributes":{"callback":null},"id":"1131","type":"DataRange1d"},{"attributes":{},"id":"1048","type":"BasicTicker"},{"attributes":{},"id":"1214","type":"BasicTickFormatter"},{"attributes":{"dimension":"height","level":"underlay","line_color":{"value":"chocolate"},"line_dash":[6],"line_width":{"value":2},"location":-1,"name":"echo"},"id":"1162","type":"Span"},{"attributes":{"callback":null,"end":512,"js_property_callbacks":{"change:value":[{"id":"1280","type":"CustomJS"}]},"name":"samples","start":64,"step":32,"title":"Samples","value":256},"id":"1279","type":"Slider"},{"attributes":{"dimension":1,"ticker":{"id":"1048","type":"BasicTicker"}},"id":"1051","type":"Grid"},{"attributes":{},"id":"1216","type":"BasicTickFormatter"},{"attributes":{"below":[{"id":"1139","type":"LinearAxis"}],"center":[{"id":"1143","type":"Grid"},{"id":"1148","type":"Grid"},{"id":"1250","type":"Legend"}],"left":[{"id":"1144","type":"LinearAxis"}],"plot_height":200,"renderers":[{"id":"1241","type":"GlyphRenderer"},{"id":"1255","type":"GlyphRenderer"}],"title":{"id":"1244","type":"Title"},"toolbar":{"id":"1155","type":"Toolbar"},"toolbar_location":null,"x_range":{"id":"1131","type":"DataRange1d"},"x_scale":{"id":"1135","type":"LinearScale"},"y_range":{"id":"1177","type":"Range1d"},"y_scale":{"id":"1137","type":"LinearScale"}},"id":"1130","subtype":"Figure","type":"Plot"},{"attributes":{"args":{"CDS":{"line":{"id":"1172","type":"ColumnDataSource"},"moment":{"id":"1175","type":"ColumnDataSource"},"quad":{"id":"1174","type":"ColumnDataSource"},"sd":{"id":"1176","type":"ColumnDataSource"},"trap":{"id":"1173","type":"ColumnDataSource"}},"checkbox":{"id":"1273","type":"CheckboxGroup"},"divs":{"acoeffs":{"id":"1168","type":"Div"},"bcoeffs":{"id":"1169","type":"Div"},"summary":{"id":"1171","type":"Div"},"tqcoeffs":{"id":"1170","type":"Div"}},"figs":{"moment":{"id":"1033","subtype":"Figure","type":"Plot"},"quad":{"id":"1065","subtype":"Figure","type":"Plot"},"sdsq":{"id":"1096","subtype":"Figure","type":"Plot"},"sdst":{"id":"1130","subtype":"Figure","type":"Plot"},"spline":{"id":"1001","subtype":"Figure","type":"Plot"}},"ranges":{"density.y":{"id":"1177","type":"Range1d"}},"sliders":{"M":{"id":"1278","type":"Slider"},"Mp":{"id":"1277","type":"Slider"},"samples":{"id":"1279","type":"Slider"},"shift":{"id":"1275","type":"Slider"},"tacq":{"id":"1276","type":"Slider"},"tas":{"id":"1274","type":"Slider"}},"spans":{"echo":{"id":"1162","type":"Span"},"echoM":{"id":"1164","type":"Span"},"echoQ":{"id":"1166","type":"Span"},"mid":{"id":"1163","type":"Span"},"midM":{"id":"1165","type":"Span"},"midQ":{"id":"1167","type":"Span"}}},"code":"\n    let M = sliders['M'].value;\n    let Mp = sliders['Mp'].value;\n    \n    let shift = sliders['shift'].value;\n    let tacq = sliders['tacq'].value;\n    let tas = sliders['tas'].value;\n    \n    let tae = tas + tacq;\n    let ttc = tas + tacq/2 + shift;\n    let oldttc = ttc;\n    \n    let samples = sliders['samples'].value\n    let centerpoint = (tae+tas)/2;\n    window.setSpanPosition(spans['echo'], ttc);\n    window.setSpanPosition(spans['echoM'], ttc);\n    window.setSpanPosition(spans['echoQ'], ttc);\n    window.setSpanPosition(spans['mid'], centerpoint);\n    window.setSpanPosition(spans['midM'], centerpoint);\n    window.setSpanPosition(spans['midQ'], centerpoint);\n    let flip = ttc &gt; centerpoint &amp;&amp; checkbox.active.length\n    if (flip) {\n        ttc = centerpoint - (ttc - centerpoint);\n    }\n    let t1 = ttc - tas;\n    let t2 = tae - ttc;\n    let g0 = 2 * Mp / tas;\n    let Mb1 = g0 * t1;\n    let Mb2 = g0 * t2;\n    let M1 =  M/2 - Mb1 - Mp;\n    let M2 =  M/2 - Mb2 - Mp;\n    let a1 = (4*(3*M1*Math.pow(t2,4) - M2*Math.pow(t1,4) + 6*M1*Math.pow(t1,2)*Math.pow(t2,2) - 6*M2*Math.pow(t1,2)*Math.pow(t2,2) + 10*M1*t1*Math.pow(t2,3) - 6*M2*Math.pow(t1,3)*t2))/(Math.pow(t1,2)*Math.pow(t2,2)*(2*t1 + 3*t2)*(t1 + t2))\n    let a2 = 12*(M2*t1*t1*t1 + 4*M2*t1*t1*t2 - 4*M1*t1*t2*t2 - M1*t2*t2*t2) / (2*t1*t1*t1*t1*t2*t2 + 3*t1*t1*t1*t2*t2*t2);\n    let a3 = 4*(M1*t2*t2*t2*t2 - 2*M2*t1*t1*t1*t1 + t1*t1*t2*t2*(6*M1 - 4*M2) + 5*M1*t1*t2*t2*t2 - 8*M2*t1*t1*t1*t2) / (t1*t1*t1*t1*t2*(t1 + t2)*(3*t2*t2 + 2*t1*t2) );\n    let b0 = a3*t1*t1*t1 + a2*t1*t1 + a1*t1;\n    let b1 = 3*a3*t1*t1 + 2*a2*t1 + a1;\n    let b2 = 3*a3*t1 + a2;\n    let b3 = -(3*a3*t1 + a2)/(3*t2);\n    let points = 20;\n    let times1 = linspace(0, t1, points);\n    let times2 = linspace(0, t2, points);\n    spline1 = window.splineWave([g0,  a1, a2, a3], times1);\n    spline2 = window.splineWave([g0+b0, b1, b2, b3], times2);\n    \n    let splines = [...spline1, ...spline2]\n    if (flip) {\n        splines.reverse()\n        ttc = tas + tacq/2 + shift;\n        console.log(ttc)\n    }\n    time = [0, tas, ...linspace(tas,ttc,points), ...linspace(ttc, tae, points), tae, tae+tas]\n    amp = [0, g0, ...splines, g0, 0]\n    CDS['line'].data.amp = amp\n    CDS['line'].data.time = time\n    CDS['line'].change.emit();\n\n    let trapamp = M/(tae-tas)\n    let trapramp = Mp*2/trapamp\n    let t_cip = (tae-tas)/2\n    let q0 = 1/(2/trapamp - 1/(g0+b0))\n    let q2 = 3*M/(2*t_cip*t_cip*t_cip) - 3*(q0)/(t_cip*t_cip)\n    CDS['trap'].data.time = [tas-trapramp, tas, tae, tae+trapramp]\n    CDS['trap'].data.amp = [0, trapamp, trapamp, 0]\n    CDS['trap'].change.emit();\n\n    let timesquad = linspace(-(tae-tas)/2, (tae-tas)/2, points);\n    let quad = window.quadWave([q0, 0, q2], timesquad)\n    let quadramp = Mp*2/quad[0]\n    time = [ tas - quadramp, tas, ...linspace(tas, tae, points), tae + quadramp]\n    amp = [ 0, quad[0], ...quad, 0]\n    CDS['quad'].data.time = time\n    CDS['quad'].data.amp = amp\n    CDS['quad'].change.emit()\n    \n    timesquad = linspace(-(tae-tas)/2, (tae-tas)/2, samples);\n    quad = window.quadWave([q0, 0, q2], timesquad)\n    quadmoment = window.integrate(timesquad, quad)\n    quadmoment = window.normalizeAndCenter(quadmoment)\n    \n    let trapmoment = window.integrate(linspace(tas, tae, samples), linspace(trapamp, trapamp, samples))\n    trapmoment = window.normalizeAndCenter(trapmoment)\n\n    times1 = linspace(0, t1, Math.round( samples*t1/(tae-tas)) );\n    times1.pop()\n    times2 = linspace(0, t2, Math.round( samples*t2/(tae-tas)) +1 );\n    spline1 = window.splineWave([g0,  a1, a2, a3], times1);\n    spline2 = window.splineWave([g0+b0, b1, b2, b3], times2);\n    let splinemoment = window.integrate(linspace(tas, tae, samples), [...spline1, ...spline2])\n    splinemoment = window.normalizeAndCenter(splinemoment)\n        \n    CDS['moment'].data.spline = splinemoment;\n    CDS['moment'].data.quad = quadmoment;\n    CDS['moment'].data.time = linspace(tas, tae, samples)\n    CDS['moment'].change.emit()\n    \n    let dwell = 0.0002\n    let samplesRaw = Math.round((tae-tas) / dwell)\n    console.log(samplesRaw)\n    let quadRaw = window.quadWave([q0, 0, q2], linspace(-(tae-tas)/2, (tae-tas)/2, samplesRaw));\n    timesquad = linspace(-(tae-tas)/2, (tae-tas)/2, samplesRaw);\n    quadmomentRaw = window.integrate(timesquad, quadRaw)\n    let quaddwelltime = window.counts(quadmomentRaw, samples)\n    \n    times1 = linspace(0, t1, Math.round( samplesRaw*t1/(tae-tas)) );\n    times1.pop()\n    times2 = linspace(0, t2, Math.round( samplesRaw*t2/(tae-tas)) +1 );\n    spline1 = window.splineWave([g0,  a1, a2, a3], times1);\n    spline2 = window.splineWave([g0+b0, b1, b2, b3], times2);\n    let splinemomentRaw = window.integrate(linspace(tas, tae, samplesRaw), [...spline1, ...spline2])\n    let splinedwelltime = window.counts(splinemomentRaw, samples)\n    \n    let trapdwelltime = window.counts(linspace(0, splinemomentRaw.slice(-1)[0], samplesRaw), samples)\n    \n    quaddwelltime = quaddwelltime.map(x =&gt; x * dwell * 1000)\n    trapdwelltime = trapdwelltime.map(x =&gt; x * dwell * 1000)\n    splinedwelltime = splinedwelltime.map(x =&gt; x * dwell * 1000)\n    if (flip) {\n        quaddwelltime.reverse();\n        trapdwelltime.reverse();\n        splinedwelltime.reverse();\n    }\n    CDS['sd'].data.samples = [...Array(quaddwelltime.length).keys()]\n    CDS['sd'].data.quad = quaddwelltime\n    CDS['sd'].data.trap = trapdwelltime\n    CDS['sd'].data.spline = splinedwelltime\n    CDS['sd'].change.emit()\n    \n    ranges['density.y'].start = 0\n    ranges['density.y'].end = (Math.max(...trapdwelltime) + Math.max(...splinedwelltime)) * 1.1\n\n    divs['acoeffs'].text = 'g0 = ' + g0.toFixed(2) + '&lt;br&gt;'\n                         + 'a1 = ' + a1.toFixed(2) + '&lt;br&gt;'\n                         + 'a2 = ' + a2.toFixed(2) + '&lt;br&gt;'\n                         + 'a3 = ' + a3.toFixed(2) + '&lt;br&gt;';\n    divs['bcoeffs'].text = 's0 =' + (g0+b0).toFixed(2) + '&lt;br&gt;'\n                         + 'b1 = ' + b1.toFixed(2) + '&lt;br&gt;'\n                         + 'b2 = ' + b2.toFixed(2) + '&lt;br&gt;'\n                         + 'b3 = ' + b3.toFixed(2) + '&lt;br&gt;';\n    divs['tqcoeffs'].text = 'q0 =' + q0.toFixed(2) + '&lt;br&gt;'\n                          + 'q2 =' + q2.toFixed(2) + '&lt;br&gt;'\n                          + '\u03bb = ' + trapamp.toFixed(2) + '&lt;br&gt;';\n    divs['summary'].text = 'Spline peak slew rate is ' + (a1*10.0).toFixed(1) + ' T/m/s.&lt;br&gt;'\n                         + 'Spline peak gradient amplitude is ' + (Math.max(...splines)*10.0).toFixed(1) + ' mT/m.&lt;br&gt;'\n                         + 'Effective dwell time at k-space center:&lt;br&gt;'\n                         + '    Stretched trapezoid ' + (trapdwelltime[samples/2]).toFixed(2) + ' \u00b5s&lt;br&gt;'\n                         + '    Spline ' + (splinedwelltime[samples/2]).toFixed(2) + ' \u00b5s&lt;br&gt;'\n                         + '    Quadratic ' + (quaddwelltime[samples/2]).toFixed(2) + ' \u00b5s&lt;br&gt;';\n    "},"id":"1280","type":"CustomJS"},{"attributes":{"callback":null},"id":"1067","type":"DataRange1d"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1217","type":"BoxAnnotation"},{"attributes":{"children":[{"id":"1274","type":"Slider"},{"id":"1275","type":"Slider"},{"id":"1276","type":"Slider"},{"id":"1277","type":"Slider"},{"id":"1278","type":"Slider"},{"id":"1279","type":"Slider"}]},"id":"1281","type":"Column"},{"attributes":{"below":[{"id":"1107","type":"LinearAxis"}],"center":[{"id":"1111","type":"Grid"},{"id":"1116","type":"Grid"},{"id":"1218","type":"Legend"}],"left":[{"id":"1112","type":"LinearAxis"}],"plot_height":200,"renderers":[{"id":"1210","type":"GlyphRenderer"},{"id":"1223","type":"GlyphRenderer"}],"title":{"id":"1097","type":"Title"},"toolbar":{"id":"1123","type":"Toolbar"},"toolbar_location":null,"x_range":{"id":"1099","type":"DataRange1d"},"x_scale":{"id":"1103","type":"LinearScale"},"y_range":{"id":"1177","type":"Range1d"},"y_scale":{"id":"1105","type":"LinearScale"}},"id":"1096","subtype":"Figure","type":"Plot"},{"attributes":{},"id":"1117","type":"PanTool"},{"attributes":{"items":[{"id":"1219","type":"LegendItem"},{"id":"1233","type":"LegendItem"}],"location":"top_center","orientation":"horizontal"},"id":"1218","type":"Legend"},{"attributes":{"below":[{"id":"1073","type":"LinearAxis"}],"center":[{"id":"1077","type":"Grid"},{"id":"1082","type":"Grid"},{"id":"1166","type":"Span"},{"id":"1167","type":"Span"}],"left":[{"id":"1078","type":"LinearAxis"}],"plot_height":400,"renderers":[{"id":"1196","type":"GlyphRenderer"},{"id":"1201","type":"GlyphRenderer"}],"title":{"id":"1292","type":"Title"},"toolbar":{"id":"1089","type":"Toolbar"},"toolbar_location":null,"x_range":{"id":"1002","type":"DataRange1d"},"x_scale":{"id":"1069","type":"LinearScale"},"y_range":{"id":"1067","type":"DataRange1d"},"y_scale":{"id":"1071","type":"LinearScale"}},"id":"1065","subtype":"Figure","type":"Plot"},{"attributes":{"children":[{"id":"1168","type":"Div"},{"id":"1169","type":"Div"},{"id":"1170","type":"Div"}]},"id":"1282","type":"Row"},{"attributes":{},"id":"1118","type":"WheelZoomTool"},{"attributes":{"label":{"value":"Quad"},"renderers":[{"id":"1210","type":"GlyphRenderer"}]},"id":"1219","type":"LegendItem"},{"attributes":{"children":[{"id":"1001","subtype":"Figure","type":"Plot"},{"id":"1065","subtype":"Figure","type":"Plot"},{"id":"1033","subtype":"Figure","type":"Plot"}]},"id":"1283","type":"Column"},{"attributes":{},"id":"1052","type":"PanTool"},{"attributes":{"overlay":{"id":"1217","type":"BoxAnnotation"}},"id":"1119","type":"BoxZoomTool"},{"attributes":{"children":[{"id":"1273","type":"CheckboxGroup"}]},"id":"1284","type":"Row"},{"attributes":{},"id":"1053","type":"WheelZoomTool"},{"attributes":{},"id":"1120","type":"SaveTool"},{"attributes":{"fields":["trap"]},"id":"1236","type":"Stack"},{"attributes":{"fill_color":"thistle","x":{"field":"samples"},"y1":{"expr":{"id":"1205","type":"Stack"}},"y2":{"expr":{"id":"1206","type":"Stack"}}},"id":"1221","type":"VArea"},{"attributes":{"children":[{"id":"1096","subtype":"Figure","type":"Plot"},{"id":"1130","subtype":"Figure","type":"Plot"}]},"id":"1286","type":"Column"},{"attributes":{"overlay":{"id":"1325","type":"BoxAnnotation"}},"id":"1054","type":"BoxZoomTool"},{"attributes":{},"id":"1121","type":"ResetTool"},{"attributes":{"fill_alpha":0.1,"fill_color":"#1f77b4","x":{"field":"samples"},"y1":{"expr":{"id":"1205","type":"Stack"}},"y2":{"expr":{"id":"1206","type":"Stack"}}},"id":"1222","type":"VArea"},{"attributes":{},"id":"1055","type":"SaveTool"},{"attributes":{},"id":"1122","type":"HelpTool"},{"attributes":{"data_source":{"id":"1176","type":"ColumnDataSource"},"glyph":{"id":"1221","type":"VArea"},"hover_glyph":null,"muted_glyph":null,"name":"spline","nonselection_glyph":{"id":"1222","type":"VArea"},"selection_glyph":null,"view":{"id":"1224","type":"CDSView"}},"id":"1223","type":"GlyphRenderer"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1117","type":"PanTool"},{"id":"1118","type":"WheelZoomTool"},{"id":"1119","type":"BoxZoomTool"},{"id":"1120","type":"SaveTool"},{"id":"1121","type":"ResetTool"},{"id":"1122","type":"HelpTool"}]},"id":"1123","type":"Toolbar"},{"attributes":{},"id":"1056","type":"ResetTool"},{"attributes":{"line_alpha":0.1,"line_color":"#1f77b4","line_width":2,"x":{"field":"time"},"y":{"field":"amp"}},"id":"1180","type":"Line"},{"attributes":{"source":{"id":"1176","type":"ColumnDataSource"}},"id":"1224","type":"CDSView"},{"attributes":{},"id":"1057","type":"HelpTool"},{"attributes":{},"id":"1230","type":"Selection"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1052","type":"PanTool"},{"id":"1053","type":"WheelZoomTool"},{"id":"1054","type":"BoxZoomTool"},{"id":"1055","type":"SaveTool"},{"id":"1056","type":"ResetTool"},{"id":"1057","type":"HelpTool"}]},"id":"1058","type":"Toolbar"},{"attributes":{},"id":"1135","type":"LinearScale"},{"attributes":{},"id":"1069","type":"LinearScale"},{"attributes":{},"id":"1137","type":"LinearScale"},{"attributes":{},"id":"1231","type":"UnionRenderers"},{"attributes":{"formatter":{"id":"1248","type":"BasicTickFormatter"},"ticker":{"id":"1140","type":"BasicTicker"}},"id":"1139","type":"LinearAxis"},{"attributes":{"fields":["trap"]},"id":"1235","type":"Stack"},{"attributes":{},"id":"1071","type":"LinearScale"},{"attributes":{"formatter":{"id":"1303","type":"BasicTickFormatter"},"ticker":{"id":"1074","type":"BasicTicker"}},"id":"1073","type":"LinearAxis"},{"attributes":{"fill_alpha":0.1,"fill_color":"#1f77b4","x":{"field":"samples"},"y1":{"expr":{"id":"1234","type":"Stack"}},"y2":{"expr":{"id":"1235","type":"Stack"}}},"id":"1240","type":"VArea"},{"attributes":{},"id":"1140","type":"BasicTicker"},{"attributes":{"text":""},"id":"1290","type":"Title"},{"attributes":{"data_source":{"id":"1176","type":"ColumnDataSource"},"glyph":{"id":"1239","type":"VArea"},"hover_glyph":null,"muted_glyph":null,"name":"trap","nonselection_glyph":{"id":"1240","type":"VArea"},"selection_glyph":null,"view":{"id":"1242","type":"CDSView"}},"id":"1241","type":"GlyphRenderer"},{"attributes":{"ticker":{"id":"1140","type":"BasicTicker"}},"id":"1143","type":"Grid"},{"attributes":{},"id":"1074","type":"BasicTicker"},{"attributes":{"text":""},"id":"1292","type":"Title"},{"attributes":{"ticker":{"id":"1074","type":"BasicTicker"}},"id":"1077","type":"Grid"}],"root_ids":["1288"]},"title":"Bokeh Application","version":"1.4.0"}}
        </script>
        <script type="text/javascript">
          (function() {
            var fn = function() {
              Bokeh.safely(function() {
                (function(root) {
                  function embed_document(root) {
                    
                  var docs_json = document.getElementById('1742').textContent;
                  var render_items = [{"docid":"6eab4db8-bbf8-40ec-a253-1c21c0a72515","roots":{"1288":"8e86d058-1fd1-454a-9878-5c76496d9c77"}}];
                  root.Bokeh.embed.embed_items(docs_json, render_items);
                
                  }
                  if (root.Bokeh !== undefined) {
                    embed_document(root);
                  } else {
                    var attempts = 0;
                    var timer = setInterval(function(root) {
                      if (root.Bokeh !== undefined) {
                        clearInterval(timer);
                        embed_document(root);
                      } else {
                        attempts++;
                        if (attempts > 100) {
                          clearInterval(timer);
                          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                        }
                      }
                    }, 10, root)
                  }
                })(window);
              });
            };
            if (document.readyState != "loading") fn();
            else document.addEventListener("DOMContentLoaded", fn);
          })();
        </script>
    
  </body>
  
</html>